/**
 * Layout Container - Sistema de Grid Gov.br
 * Baseado nas especificações oficiais do Design System do Governo Federal
 * https://www.gov.br/ds/fundamentos-visuais/grid
 */

// Breakpoints oficiais do Design System Gov.br
$govbr-breakpoints: (
  mobile-portrait: 0,        // 0-575px (4 colunas)
  mobile-landscape: 576px,   // 576-991px (8 colunas)  
  tablet-landscape: 992px,   // 992-1279px (8 colunas)
  desktop: 1280px,          // 1280-1599px (12 colunas)
  tv: 1600px                // 1600px+ (12 colunas)
);

// Configurações de grid por breakpoint
$govbr-grid-configs: (
  mobile-portrait: (
    columns: 4,
    gutter: 16px,
    margin: 8px,
    max-width: 100%
  ),
  mobile-landscape: (
    columns: 8,
    gutter: 24px,
    margin: 40px,
    max-width: 100%
  ),
  tablet-landscape: (
    columns: 8,
    gutter: 24px,
    margin: 40px,
    max-width: 1199px
  ),
  desktop: (
    columns: 12,
    gutter: 24px,
    margin: 40px,
    max-width: 1519px
  ),
  tv: (
    columns: 12,
    gutter: 40px,
    margin: 40px,
    max-width: none
  )
);

// Espaçamentos verticais baseados em múltiplos de 8px
$govbr-spacing: (
  none: 0,
  small: 16px,    // 2 * 8px
  medium: 32px,   // 4 * 8px
  large: 48px,    // 6 * 8px
  extra-large: 64px // 8 * 8px
);

// Mixins para responsividade
@mixin govbr-breakpoint($name) {
  @if map-has-key($govbr-breakpoints, $name) {
    $breakpoint: map-get($govbr-breakpoints, $name);
    @if $breakpoint > 0 {
      @media (min-width: #{$breakpoint}) {
        @content;
      }
    } @else {
      @content;
    }
  }
}

// Componente principal
.ifc-ds-layout-container {
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  position: relative;
  
  // Container fluído (padrão)
  &--fluid {
    max-width: 100%;
    
    .ifc-ds-layout-container__content {
      display: grid;
      width: 100%;
      
      // Mobile Portrait (4 colunas)
      grid-template-columns: repeat(4, 1fr);
      gap: map-get(map-get($govbr-grid-configs, mobile-portrait), gutter);
      padding: 0 map-get(map-get($govbr-grid-configs, mobile-portrait), margin);
      
      // Mobile Landscape / Tablet Portrait (8 colunas)
      @include govbr-breakpoint(mobile-landscape) {
        grid-template-columns: repeat(8, 1fr);
        gap: map-get(map-get($govbr-grid-configs, mobile-landscape), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, mobile-landscape), margin);
      }
      
      // Tablet Landscape (8 colunas)
      @include govbr-breakpoint(tablet-landscape) {
        grid-template-columns: repeat(8, 1fr);
        gap: map-get(map-get($govbr-grid-configs, tablet-landscape), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, tablet-landscape), margin);
      }
      
      // Desktop (12 colunas)
      @include govbr-breakpoint(desktop) {
        grid-template-columns: repeat(12, 1fr);
        gap: map-get(map-get($govbr-grid-configs, desktop), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, desktop), margin);
      }
      
      // TV (12 colunas com gutter maior)
      @include govbr-breakpoint(tv) {
        grid-template-columns: repeat(12, 1fr);
        gap: map-get(map-get($govbr-grid-configs, tv), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, tv), margin);
      }
    }
  }
  
  // Container fixo
  &--fixed {
    .ifc-ds-layout-container__content {
      display: grid;
      margin: 0 auto;
      
      // Mobile Portrait
      max-width: calc(100% - #{2 * map-get(map-get($govbr-grid-configs, mobile-portrait), margin)});
      grid-template-columns: repeat(4, 1fr);
      gap: map-get(map-get($govbr-grid-configs, mobile-portrait), gutter);
      padding: 0 map-get(map-get($govbr-grid-configs, mobile-portrait), margin);
      
      // Mobile Landscape / Tablet Portrait
      @include govbr-breakpoint(mobile-landscape) {
        max-width: calc(100% - #{2 * map-get(map-get($govbr-grid-configs, mobile-landscape), margin)});
        grid-template-columns: repeat(8, 1fr);
        gap: map-get(map-get($govbr-grid-configs, mobile-landscape), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, mobile-landscape), margin);
      }
      
      // Tablet Landscape
      @include govbr-breakpoint(tablet-landscape) {
        max-width: map-get(map-get($govbr-grid-configs, tablet-landscape), max-width);
        grid-template-columns: repeat(8, 1fr);
        gap: map-get(map-get($govbr-grid-configs, tablet-landscape), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, tablet-landscape), margin);
      }
      
      // Desktop
      @include govbr-breakpoint(desktop) {
        max-width: map-get(map-get($govbr-grid-configs, desktop), max-width);
        grid-template-columns: repeat(12, 1fr);
        gap: map-get(map-get($govbr-grid-configs, desktop), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, desktop), margin);
      }
      
      // TV - mantém largura fixa recomendada
      @include govbr-breakpoint(tv) {
        max-width: 1920px; // Largura máxima recomendada para TV
        grid-template-columns: repeat(12, 1fr);
        gap: map-get(map-get($govbr-grid-configs, tv), gutter);
        padding: 0 map-get(map-get($govbr-grid-configs, tv), margin);
      }
    }
  }
  
  // Configurações de colunas específicas
  @for $i from 1 through 12 {
    &--columns-#{$i} {
      .ifc-ds-layout-container__content {
        // Ajusta o número de colunas conforme especificado
        @include govbr-breakpoint(desktop) {
          grid-template-columns: repeat(#{min($i, 12)}, 1fr);
        }
        
        @include govbr-breakpoint(tablet-landscape) {
          grid-template-columns: repeat(#{min($i, 8)}, 1fr);
        }
        
        @include govbr-breakpoint(mobile-landscape) {
          grid-template-columns: repeat(#{min($i, 8)}, 1fr);
        }
        
        // Mobile sempre 4 colunas máximo
        grid-template-columns: repeat(#{min($i, 4)}, 1fr);
      }
    }
  }
  
  // Espaçamentos verticais
  @each $name, $value in $govbr-spacing {
    &--spacing-#{$name} {
      padding-top: $value;
      padding-bottom: $value;
    }
  }
  
  // Alinhamentos horizontais
  &--align-left {
    .ifc-ds-layout-container__content {
      margin-left: 0;
      margin-right: auto;
    }
  }
  
  &--align-center {
    .ifc-ds-layout-container__content {
      margin-left: auto;
      margin-right: auto;
    }
  }
  
  &--align-right {
    .ifc-ds-layout-container__content {
      margin-left: auto;
      margin-right: 0;
    }
  }
  
  // Sangria (Bleed) - permite elementos quebrarem as margens
  &--bleed {
    overflow: visible;
    
    .ifc-ds-layout-container__content {
      position: relative;
    }
    
    // Elementos filhos podem usar classes de sangria
    .ifc-ds-bleed-full {
      margin-left: calc(-1 * var(--grid-margin, 40px));
      margin-right: calc(-1 * var(--grid-margin, 40px));
    }
    
    .ifc-ds-bleed-left {
      margin-left: calc(-1 * var(--grid-margin, 40px));
    }
    
    .ifc-ds-bleed-right {
      margin-right: calc(-1 * var(--grid-margin, 40px));
    }
  }
  
  // Conteúdo principal
  &__content {
    width: 100%;
    min-height: 50px; // Altura mínima para visibilidade no editor
    
    // Filhos diretos ocupam pelo menos uma coluna
    > * {
      grid-column: span 1;
      min-width: 0; // Previne overflow de conteúdo
    }
    
    // Classes utilitárias para spans de coluna
    .col-span-1 { grid-column: span 1; }
    .col-span-2 { grid-column: span 2; }
    .col-span-3 { grid-column: span 3; }
    .col-span-4 { grid-column: span 4; }
    .col-span-5 { grid-column: span 5; }
    .col-span-6 { grid-column: span 6; }
    .col-span-7 { grid-column: span 7; }
    .col-span-8 { grid-column: span 8; }
    .col-span-9 { grid-column: span 9; }
    .col-span-10 { grid-column: span 10; }
    .col-span-11 { grid-column: span 11; }
    .col-span-12 { grid-column: span 12; }
    .col-span-full { grid-column: 1 / -1; }
  }
  
  // Label de preview no editor
  &__preview-label {
    position: absolute;
    top: -24px;
    left: 0;
    font-size: 11px;
    color: #666;
    background: rgba(255, 255, 255, 0.9);
    padding: 2px 6px;
    border-radius: 3px;
    border: 1px solid #ddd;
    z-index: 1;
    pointer-events: none;
    
    @media (max-width: 782px) {
      position: static;
      margin-bottom: 8px;
      display: inline-block;
    }
  }
}

// Estilos específicos para o editor
.editor-styles-wrapper {
  .ifc-ds-layout-container {
    border: 2px dashed #e0e0e0;
    border-radius: 4px;
    transition: border-color 0.2s ease;
    
    &:hover {
      border-color: #007cba;
    }
    
    &.is-selected {
      border-color: #007cba;
      border-style: solid;
    }
    
    &__content {
      position: relative;
      min-height: 100px;
      
      &:empty::before {
        content: "Adicione blocos dentro do container de layout";
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100px;
        color: #999;
        font-style: italic;
        text-align: center;
      }
    }
  }
}

// Variáveis CSS para uso dinâmico
.ifc-ds-layout-container {
  // Mobile Portrait
  --grid-margin: #{map-get(map-get($govbr-grid-configs, mobile-portrait), margin)};
  --grid-gutter: #{map-get(map-get($govbr-grid-configs, mobile-portrait), gutter)};
  --grid-columns: #{map-get(map-get($govbr-grid-configs, mobile-portrait), columns)};
  
  @include govbr-breakpoint(mobile-landscape) {
    --grid-margin: #{map-get(map-get($govbr-grid-configs, mobile-landscape), margin)};
    --grid-gutter: #{map-get(map-get($govbr-grid-configs, mobile-landscape), gutter)};
    --grid-columns: #{map-get(map-get($govbr-grid-configs, mobile-landscape), columns)};
  }
  
  @include govbr-breakpoint(tablet-landscape) {
    --grid-margin: #{map-get(map-get($govbr-grid-configs, tablet-landscape), margin)};
    --grid-gutter: #{map-get(map-get($govbr-grid-configs, tablet-landscape), gutter)};
    --grid-columns: #{map-get(map-get($govbr-grid-configs, tablet-landscape), columns)};
  }
  
  @include govbr-breakpoint(desktop) {
    --grid-margin: #{map-get(map-get($govbr-grid-configs, desktop), margin)};
    --grid-gutter: #{map-get(map-get($govbr-grid-configs, desktop), gutter)};
    --grid-columns: #{map-get(map-get($govbr-grid-configs, desktop), columns)};
  }
  
  @include govbr-breakpoint(tv) {
    --grid-margin: #{map-get(map-get($govbr-grid-configs, tv), margin)};
    --grid-gutter: #{map-get(map-get($govbr-grid-configs, tv), gutter)};
    --grid-columns: #{map-get(map-get($govbr-grid-configs, tv), columns)};
  }
}